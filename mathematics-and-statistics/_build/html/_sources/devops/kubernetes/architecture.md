# Архитектура

В Kubernetes каждый сервис (микросервис) может запускаться не на одном отдельном сервере, а распределяться по разным узлам (нодам) кластера. На каждом узле могут работать несколько подов (Pods) — атомарных единиц развертывания, внутри которых запускаются контейнеры с приложениями<sup>[2]</sup>.

## Где находится Kubernetes и как происходит связь

- **Кластер Kubernetes** состоит из управляемого Control Plane и множества рабочих узлов (Nodes). Control Plane отвечает за планирование, распределение подов по узлам и общую оркестрацию<sup>[2]</sup>.
- **Под (Pod)** — это одна или несколько контейнеризированных частей приложения, которые работают вместе на одном узле, имеют общий IP и ресурсы<sup>[2]</sup>.
- **Узлы (Nodes)** — это серверы (виртуальные или физические), на которых запускаются поды. Control Plane следит, чтобы нагрузка распределялась равномерно и поды запускались корректно<sup>[2]</sup>.

## Как микросервисы связываются между собой

- Для взаимодействия подов в Kubernetes используют объект **Service (сервис)**. Это абстракция, которая предоставляет постоянный IP-адрес и DNS-имя для группы подов<sup>[1]</sup> <sup>[4]</sup>.
- Поскольку поды динамичны и могут перезапускаться, IP подов меняется. Service маскирует это, направляя запросы по виртуальному IP к нужным подам на основе селекторов и меток (labels)<sup>[5]</sup>.
- Внутри кластера сервисы общаются по DNS-именам, например, `service-name.namespace.svc.cluster.local`, что упрощает взаимодействие и поддерживает отказоустойчивость<sup>[7]</sup>.

## Итог

- Микросервисы не привязаны к одному серверу, а распределены по узлам кластера<sup>[2]</sup>.
- Kubernetes контролирует размещение и поддерживает нужное количество экземпляров сервисов<sup>[2]</sup>.
- Сервисы обеспечивают стабильное взаимодействие между подами, скрывая их динамический характер и балансируя нагрузку<sup>[4]</sup> <sup>[5]</sup>.

Таким образом, Kubernetes представляет собой распределённую платформу с централизованным управлением, где физические или виртуальные серверы объединены в кластер, а связь между сервисами обеспечивается через объекты Service с постоянными адресами внутри кластера. В Kubernetes микросервисы запускаются не обязательно на отдельных физических серверах, а распределяются по узлам (Nodes) кластера, которыми могут быть виртуальные или физические машины. Узел может содержать несколько подов (Pods) — групп контейнеров с одним IP-адресом и ресурсами, запускаемых вместе на одном узле. Таким образом, каждый микросервис может иметь несколько подов, размещённых на разных узлах кластера<sup>[1]</sup> <sup>[4]</sup> <sup>[5]</sup>.

Связь между подами происходит через объект Kubernetes под названием Service. Этот объект предоставляет стабильный виртуальный IP-адрес и DNS-имя для группы подов, скрывая динамическую смену IP самих подов и обеспечивая балансировку нагрузки. Поды общаются друг с другом по DNS-именам, например, service-name.namespace.svc.cluster.local, что упрощает взаимодействие и обеспечивает отказоустойчивость.

Сам Kubernetes состоит из управляющей плоскости (control plane), которая координирует кластер, и рабочих узлов, на которых запускаются поды. Control plane следит за тем, чтобы поды успешно запускались, распределялись по узлам и масштабировались в зависимости от нагрузки.

Таким образом, микросервисы работают как распределённые приложения в кластере, а Kubernetes обеспечивает их организацию, взаимодействие и надёжность через сервисы и контейнеры, распределённые по множеству серверов<sup>[4]</sup> <sup>[5]</sup> <sup>[1]</sup> <sup>[2]</sup>.

[1]: https://habr.com/ru/articles/488796/
[2]: https://kubernetes.io/ru/docs/tutorials/kubernetes-basics/explore/explore-intro/
[3]: https://labex.io/ru/tutorials/kubernetes-connecting-pods-with-kubernetes-services-15815
[4]: https://kubernetes.io/ru/docs/tutorials/kubernetes-basics/expose/expose-intro/
[5]: https://ipsoftware.ru/posts-cloud/k8s-3-services/
[6]: https://timeweb.cloud/tutorials/kubernetes/tipy-servisov-kubernetes-kak-vybrat
[7]: https://www.reddit.com/r/kubernetes/comments/zbcl1k/how_should_microservicespods_communicate_in_a/
[8]: https://habr.com/ru/companies/slurm/articles/337088/
[9]: https://systems.education/architecting-distributed-transactional-apps-layers